## 项目经历

#### I.单点登录

###### 令牌

- Header（头部）：包含了令牌的类型和所使用的加密算法。
- Payload（荷载）：包含了令牌的具体信息，如用户ID、角色、过期时间等。这部分通常是一个 JSON 对象。
- Signature（签名）：使用私钥对 Header 和 Payload 进行签名，以确保令牌的完整性和真实性。

###### 令牌授权

1. **授权令牌的流程：**

	- 用户通过身份验证成功后，SSO 系统会生成一个授权令牌。

	- 授权令牌包含了关于用户身份和授权的信息，如用户ID、访问权限、过期时间等。

	- 用户在访问其他关联应用时，将授权令牌提供给该应用。

	- 应用解析令牌，验证用户身份并检查授权信息，从而决定是否允许用户访问。

2. **生成令牌荷载（Payload）：** 

	将收集到的用户信息和授权信息组织成一个被称为 "荷载" 的数据结构。这个荷载可以是一个 JSON 格式的对象，其中包含了用户的信息和授权数据。

3. **授权令牌的加密和签名：** 授权令牌通常需要在传输过程中进行保护，以防止恶意用户篡改或伪造令牌。加密和签名是常用的保护机制。

	- **加密：** 令牌的敏感信息可以通过加密算法进行加密，以确保在传输过程中不会被窃取。常见的加密算法有 AES（高级加密标准）等。
	- **签名：** 为了防止令牌被篡改，令牌通常会包含一个数字签名，用于验证令牌的完整性。使用私钥对令牌内容进行签名，然后其他应用可以使用相应的公钥来验证签名的有效性。常见的签名算法有 HMAC（哈希消息认证码）等。

###### RSA加密

1. **密钥生成：** 授权中心生成一对非对称密钥，包括公钥和私钥。私钥用于对数字签名进行加密，公钥用于解密。
2. **生成令牌：** 授权中心生成授权令牌，包括用户身份信息、权限、有效期等。同时，将敏感信息添加到令牌中。
3. **加密敏感信息：** 授权中心使用接收者（在这里是业务系统）的公钥对令牌中的敏感信息进行加密。这样只有持有相应私钥的业务系统才能解密。
4. **数字签名：** 授权中心使用自己的私钥对整个令牌进行数字签名，以保证令牌的完整性和真实性。
5. **发送令牌：** 授权中心将加密后的令牌和数字签名一起发送给客户端。
6. **分发私钥：** 授权中心将用于验证签名的私钥分发给业务系统。
7. **客户端发送请求：** 客户端在访问业务系统时，将加密后的令牌和签名放在请求头中。
8. **业务系统验证签名和解密：** 业务系统首先使用授权中心分发的私钥来验证令牌的签名。如果签名有效，然后使用自己的私钥对令牌中的敏感信息进行解密。

###### 验证数字签名

1. **获取公钥：** 在数字签名验证过程中，您需要获得签名的来源方（通常是消息发送者）的公钥。这通常是通过安全途径获取的，确保公钥的安全性和完整性。
2. **提取签名和原始数据：** 数字签名通常是应用在原始数据上的摘要，生成的签名一起发送。在验证签名之前，需要从原始数据中提取签名。
3. **验证签名：** 使用获取的公钥对提取的签名进行验证。验证的方法会根据签名算法的类型而不同，但基本思想是使用公钥对原始数据重新生成摘要，然后将这个重新生成的摘要与提取的签名进行比较。如果两者相同，签名验证成功；如果不同，则验证失败。
	- **RSA 签名验证：** 对原始数据应用公钥的指数和模数进行加密，然后将结果与提取的签名进行比较。
	- **ECDSA 签名验证：** 使用公钥对原始数据生成一个椭圆曲线点，然后将这个点与提取的签名中的一部分进行比较。
4. **处理验证结果：** 验证结果会告诉您签名是有效的还是无效的。根据结果，您可以决定是否信任原始数据的来源。

#### II.超级粉丝通报表系统

###### 团队协作

Git的使用

###### 广告系列

广告系列是创建广告的最大单元，它代表创建一个投放组，确认营销目标。

编辑、添加广告计划、设置状态、移除；

###### 广告计划

广告计划用于设置定向、出价和排期等。

编辑、查看、添加广告创意、设置状态、移除；

（一）设置投放场景，场景选择包括优选场景、竖版视频流、正文页、评论流、受众联盟

（二）设置优化目标目标：曝光、点击、转化等

（三）设置受众定向，定向包括可使用基础人群属性定向，或使用数据市场及自定义数据

（四）设置预算与排期，包括单日预算、投放排期、投放时段、计费模式、设置出价等

###### 广告创意

广告创意为投放的广告**内容和样式**。

编辑、查看、设置状态、移除；

（一）选择广告资质：需要选择广告投放所需的资质材料

（二）选择发布时间，立即发布或定时发布，若选择定时发布，需要设置发布时间

（三）选择发布状态，若勾选只用于广告展示，则该创意不在账户的个人主页展示

（四）选择评论状态，开启或关闭，关闭后博文将不允许用户评论

#### III.蜂巢系统

##### SSO（单点登录）

> CipherUtils：利用RSA非对称加密算法实现加密工具组件，具有公钥加密，私钥解密
>
> - 使用ECB模式进行分段加密，以避免处理大块数据时出现内存问题
> - 非对称加密组件主要用于实现Session会话信息加密解密：软件版本号 + MD5码 + 数字签名
>
> KeyStorage：不同路由域名下所对应的RSA密文和RC4密文
>
> - `RSA Key` 包含一对公私钥，用于非对称加密和数字签名。
> - `RC4 Key` 是对称加密中的密钥，用于流加密。
>
> SDKClient：单点登录响应状态码及响应状态信息，利用PoolingHttpClientConnectionManager配置单路由最大并发数
>
> Session：服务端账户缓存，包括用户ID、用户登录状态、登录过期时间等

###### 模块概要

- **CipherUtils（加密组件）**
	- **RC4 加密：** `CipherUtils` 提供了 `RC4Encrypt` 方法，用于对输入的数据使用 RC4 加密算法进行加密。RC4 是一种对称加密算法，用于在 `Sid` 类中对数据进行加密，保护数据的机密性。
	- **RC4 解密：** `CipherUtils` 提供了 `RC4Decrypt` 方法，用于对使用 RC4 加密的数据进行解密。在 `Sid` 类的 `parseV2` 方法中，该方法用于对 RC4 加密后的数据进行解密，以还原原始数据。
	- **MD5 计算：** 在 `Sid` 类的 `parseV2` 方法中，`CipherUtils` 被用于计算数据的 MD5 哈希值，用于验证数据的完整性。MD5 在这里主要用于验证签名。
	- **分段加密：**使用ECB模式进行分段加密，以避免处理大块数据时出现内存问题

- **SDKConfig（配置对象）：**
	- `SDKConfig` 类用于配置 SDK 的一些参数，例如服务器入口、IP 地址、PIN 码、域名、超时时间等。
	- 在流程开始时，创建一个 `SDKConfig` 对象，用于初始化 `SDKClient`。
- **KeyStorage（密钥存储）：**
	- `KeyStorage` 类用于存储不同域名和版本的密钥信息，包括 RSA 公钥、RC4 密钥等。
	- 在初始化过程中，`KeyStorage` 类加载默认的密钥信息。
- **SDKClient（SDK 客户端）：**
	- `SDKClient` 类是 SDK 的主要入口，用于进行用户认证和会话管理。
	- 在初始化时，创建 `CloseableHttpClient` 对象，配置连接池和请求参数。
	- 提供 `auth` 方法用于用户认证，根据参数选择本地认证还是远程认证。
	- 提供 `getUserFromCookie` 方法用于从 Cookie 中获取用户信息。
- **Session（会话信息）：**
	- `Session` 类用于表示用户的会话信息，包括用户状态、标识、访问时间、授权信息等。
	- 包含了对会话信息的解析和处理方法，例如判断会话是否过期、是否为微信用户等。
- **Sid（SUB 解析）：**
	- `Sid` 类提供了解析 SUB 的方法，根据 SUB 的版本选择相应的解析方式。
	- 目前支持 v2 版本的 SUB，其中包括解密和解析会话信息的操作。
- **User（用户信息）：**
	- `User` 类用于封装用户信息，包括会话信息、用户标识、续期后的 SID 和 SUB 等。
	- 提供一系列方法用于获取用户的状态、属性等信息。

###### 整体流程

- **提取签名和数据：** 首先，从经过Base64解码的`sub`中提取字节数组 `bytes`，然后将其切分为两部分，`data` 和 `sign`。`data` 是数据的主体部分，`sign` 是数据的签名部分。
- **获取公钥：** 根据 `domain` 和 `kver`（版本号）使用 `KeyStorage.getSubPubKey(domain, kver)` 获取相应的公钥 `pubkey`。
- **MD5 计算摘要：** 对 `data` 进行 MD5 摘要，得到摘要值 `m`。
- **RSA 解密签名：** 使用 `pubkey` 对 `sign` 进行 RSA 解密，得到解密后的字符串 `mm`。
- **签名验证：** 验证 `mm` 的长度是否为9，并且是否与 `m` 的前9位匹配。如果匹配，说明数据在传输过程中没有被篡改。

##### Auth（鉴权）

> 通过总部鉴权中台提供的服务接口来验证账户信息及其权限

##### Service（核心业务）

> AccountService：微博账户业务
>
> AdvertService：微博广告数据报表业务
>
> AppService：微博广告应用（RPC）调用业务
>
> BrandService：汽车品牌业务
>
> CampaignService：微博广告系列业务
>
> CarService：汽车业务
>
> CategoryService：抽象类型（具有继承关系的业务属性）业务
>
> CityService：城市列表
>
> CorpService：国家列表
>
> LeadBlockService：黑名单业务
>
> LeadsService：投放线索业务
>
> IpAddressService：IP地址业务
>
> ExecuteParamService：广告投放执行流程业务
>
> ExecutePlanService：广告投放执行计划业务
>
> ProjectSevice：广告投放计划业务
>
> ProjectStatisticService：广告投放计划统计业务
>
> RpcLoggerService：RPC（远程调用）日志业务
>
> RpcTaskerService：RPC（远程调用）任务业务
>
> GroupService：部门业务
>
> StaffService：员工业务
>
> LoginService：登录业务
>
> UserService：登录用户业务

##### Domain

> User

##### SMS（邮箱服务）

> 利用LinkedMultiValueMap发送请求调用新浪信箱服务

##### Logger（RPC日志）

> 记录超粉系统远程过程调用（RPC）中的相关信息，将其记录到数据库或者日志当中
>
> 日志信息：同步到超粉系统、获取超粉数据、同步到客户系统、授权AccessToken、同步到汽车频道、线索预填请求、系统预填回写

##### Common（工具包）

> PageBar：分页查询返回数据结果
>
> ApplicationContextUtils：应用上下文通用工具类组件
>
> CaptchaUtil：图片验证码通用工具类组件，生成图像验证码时可以设置背景色、字体、干扰线，还可以添加噪点
>
> CookieUtil：浏览器缓存通用工具类组件
>
> CryptoUtils：加密解密通用工具类组件
>
> DateUtils：格式化时间通用工具类组件
>
> JarUtil：Jar打包工具类组件，负责将jar解压到指定目录
>
> MD5Util、RandomUtil、SerializeUtils：MD5、验证码（数字）、序列化组件